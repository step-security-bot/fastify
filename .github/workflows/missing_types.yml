name: Missing Types

on:
  pull_request:
    types: [closed]

permissions:
  issues: write
  pull-requests: read

jobs:
  create_issue:
    runs-on: ubuntu-latest
    if: |
      github.event.pull_request.merged &&
      contains(github.event.pull_request.labels.*.name, 'missing-types')
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@8ca2b8b2ece13480cda6dacd3511b49857a23c09 # v2.5.1
        with:
          egress-policy: audit

      - name: Create an issue
        uses: octokit/request-action@b074a26ca664c4af577b79c2daa7c588bda70e87 # v2.x
        with:
          route: POST /repos/{owner}/{repo}/issues
          owner: ${{ github.repository_owner }}
          repo: ${{ github.event.repository.name }}
          title: add missing types to [${{ github.event.pull_request.title }}]
          body: |
            PR [${{ github.event.pull_request.number }}](${{ github.event.pull_request.html_url }}) has introduced a new feature that requires updating Fastify's typings and tests.


            Learn how to [contribute](https://github.com/fastify/fastify/blob/main/CONTRIBUTING.md)

            Get inspired by [this example PR](https://github.com/fastify/fastify/pull/3231)
          labels: |
            ["good-first-issue", "typescript"]
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
